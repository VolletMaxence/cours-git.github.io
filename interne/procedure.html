<!doctype html>
<html lang="fr">

<head>
<meta charset="utf-8">
</head>

<body>
<pre>

== Procedure Cours Gestion Version ==
Version 1.0.3 du 30 aout 2015

= Avant le cours =
* [Enseignant] Changer année dans tp.html et cours.html

* [Sysadmin] changer le shell du user git dans /etc/passwd sur le serveur git de /usr/bin/git-shell vers /bin/bash (pour permettre aux étudiants
de faire des ssh-copy-id)

* [Sysadmin] Prévoir un depot SVN par binome. 
	- Pas de trinomes 
	- Prévoir une marge de 5 comptes
	- Désactiver les habilitations LDAP sur les depots, chaque etudiant doit pouvoir être affecté à n'importe quel dépot
(permet de repartir les depots en fonction des besoins en cours)
	- URL : https://subversion.iut-nantes.univ-nantes.fr/~licpro-2015/b&lt;code_binôme&gt;/
	- Pas de padding dans les numeros
	- Exemples :
https://subversion.iut-nantes.univ-nantes.fr/~licpro-2015-b1 
https://subversion.iut-nantes.univ-nantes.fr/~licpro-2015-b30

* [Enseignant] optionnel : Demander habilitation pour tests ou demos. 
Attention : l'habilitation est revoquée en juin suivant. 
Utile en particulier pour pouvoir récupérer les commits des étudiants pour évaluation.

* [Enseignant] Si pas déjà fait, préparer le dépot git de 'bootstrap' (réutilisable d'une année sur l'autre) : 
$ cd /var/lib/git/repo_source/my-app
$ git init
$ [copier les sources], le repertoire .git doit être au même niveau que le fichier pom.xml
$ git add .
$ git commit -m "Import initial par le responsable technique du projet"

* [Enseignant] Preparer les dépots git de l'année : 
	- Sur le serveur gitinfo, créer un repertoire /var/lib/git/repos<année YYYY>
	- Créer les depos bare (vides)
$ cd  /var/lib/git/repos<année YYYY>
$ for i in {1..<nombre de binomes>}; do mkdir -p b$i/my-app.git; cd b$i/my-app.git; git init --bare; cd ../..; done
- Supprimer les remotes de l'années precedente :
$ for i in {1..30}; do git remote rm remote_$i; done
- Ajouter des remotes du depot source vers tous les depots bare puis pousser master vers tous les remotes :
for i in {1..30}; do git remote add remote_$i file:///var/lib/git/repos<année YYYY>/b$i/my-app.git; 
git push remote_$i master; done
Attention : cette étape est obligatoire sans quoi les dépots git ne contiendront pas de commit initial 
et les étudiants n'auront pas de branche master ni remotes lors du clone.
- Pour tester, sur un poste :
$ git clone ssh://git@gitinfo.iut-nantes.univ-nantes.prive/var/lib/git/repos2015/b30/my-app.git

= Pendant le cours =
* [Enseignant] Affectation d'un code binome commun SVN/GIT à chaque binome (il peut y avoir un étudiant seul qui joue un binome). 
Le binome doit ensuite se répartir le rôle A ou B.

= Apres le cours =
* [Enseignant] Récupération des logs pour eval : git@gitinfo:/var/lib/git/repos2015$ for i in {1..30}; do cd b$i/my-app.git; git log > /tmp/b$i.log;cd ..; done
	Puis (sur son poste) : scp git@gitinfo/tmp/b*.log .

* [Enseignant] Changer /etc/passwd serveur Git, passer git en /usr/bin/git-shell pour éviter que des éleves puissent se loguer en ssh sur le serveur

* [Eleves] Supprimer les mots de passe Subversion stockés en clair dans chaque ~/.subversion/auth 

* [Enseignant] Supprimer ou archiver les dépôts git
$ mv /var/lib/git/reposYYYY /var/lib/git/old/

* [Sysadmin] Supprimer ou archiver les dépots SVN 

</pre>
</body>
</html>